<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Panel | DriveX</title>
  <style>
    :root { --accent: #ff5f00; --bg: #111; --card-bg: #1c1c1c; }
    body { background: var(--bg); color: #fff; font-family: 'Inter', sans-serif; padding: 40px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; border-bottom: 2px solid #333; padding-bottom: 20px; }
    h1 { margin: 0; font-weight: 900; }
    h1 span { color: var(--accent); }
    
    .stats-bar { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin-bottom: 40px; }
    .stat-card { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid #333; text-align: center; }
    .stat-card h3 { margin: 0; color: #888; font-size: 14px; text-transform: uppercase; }
    .stat-card p { margin: 10px 0 0; font-size: 32px; font-weight: 800; color: var(--accent); }

    table { width: 100%; border-collapse: collapse; background: var(--card-bg); border-radius: 12px; overflow: hidden; }
    th { background: #252525; padding: 15px; text-align: left; color: var(--accent); text-transform: uppercase; font-size: 12px; }
    td { padding: 15px; border-bottom: 1px solid #333; font-size: 14px; }
    tr:hover { background: #222; }

    .btn-delete { background: #ff3333; color: white; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; }
    .btn-delete:hover { background: #cc0000; }
    
    .btn-refresh { background: var(--accent); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>

<header>
  <h1>DRIVE<span>X</span> ADMIN</h1>
  <button class="btn-refresh" onclick="loadReservations()">Refresh Data</button>
  <button class="btn-delete" style="background: #555; margin-left: 10px;" onclick="clearAllData()">
    Reset Databases
</button>
</header>

<div class="stats-bar">
  <div class="stat-card">
    <h3>Total Bookings</h3>
    <p id="totalCount">0</p>
  </div>
  <div class="stat-card">
    <h3>Revenue</h3>
    <p id="totalRevenue">$0</p>
  </div>
  <div class="stat-card">
    <h3>System Status</h3>
    <p style="color: #00ff00; font-size: 18px; margin-top: 20px;">ONLINE</p>
  </div>
</div>

<table>
  <thead>
    <tr>
      <th>ID</th>
      <th>Customer ID</th>
      <th>Vehicle</th>
      <th>Total Price</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody id="reservationsTable">
    </tbody>
</table>

<script>
  async function loadReservations() {
    try {
      const response = await fetch('http://localhost:8080/api/admin/reservations');
      const data = await response.json();
      
      const tableBody = document.getElementById('reservationsTable');
      tableBody.innerHTML = '';
      
      let revenue = 0;
      data.forEach(res => {
        revenue += res.totalPrice;
        tableBody.innerHTML += `
          <tr>
            <td>#${res.id}</td>
            <td>${res.customerId}</td>
            <td>ID: ${res.vehicleId}</td>
            <td>$${res.totalPrice}</td>
            <td><span style="color: #ffaa00">${res.status}</span></td>
            <td>
              <button class="btn-delete" onclick="deleteReservation(${res.id})">Delete</button>
            </td>
          </tr>
        `;
      });
      
      document.getElementById('totalCount').innerText = data.length;
      document.getElementById('totalRevenue').innerText = '$' + revenue.toFixed(2);
      
    } catch (err) {
      console.error("Failed to load data", err);
    }
  }

  async function deleteReservation(id) {
    if (!confirm(`Are you sure you want to delete reservation #${id}?`)) return;

    try {
      const response = await fetch(`http://localhost:8080/api/admin/reservations/${id}`, {
        method: 'DELETE'
      });

      if (response.ok) {
        alert("Deleted successfully");
        loadReservations(); 
      }
    } catch (err) {
      alert("Error deleting record");
    }
  }

  async function clearAllData() {
    if (!confirm("ВНИМАНИЕ! Это удалит ВСЕ заказы и ВСЕХ клиентов. Продолжить?")) return;

    try {
        const response = await fetch('http://localhost:8080/api/admin/clear-all', {
            method: 'POST'
        });

        if (response.ok) {
            alert("База данных полностью очищена");
            loadReservations();
        }
    } catch (err) {
        alert("Ошибка при очистке");
    }
}

  window.onload = loadReservations;
</script>

</body>
</html>